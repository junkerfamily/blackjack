<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Casino Blackjack</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/cards.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/blackjack.css') }}">
</head>
<body>
    <div class="casino-table">
        <!-- Header -->
        <header class="table-header">
            <h1>üé∞ CASINO BLACKJACK</h1>
            <div class="header-controls">
                <button class="info-toggle" id="info-toggle" aria-label="Rules and help">
                    ‚ÑπÔ∏è
                </button>
                <button class="settings-toggle" id="settings-toggle" aria-label="Heckler settings">
                    ‚öôÔ∏è
                </button>
            </div>
        </header>

        <!-- Rules Panel -->
        <div class="rules-panel" id="rules-panel" role="dialog" aria-labelledby="rules-title" aria-hidden="true">
            <div class="rules-header">
                <span class="rules-title" id="rules-title">How to Play</span>
                <button class="rules-close" id="rules-close" aria-label="Close rules">‚úï</button>
            </div>
            <div class="rules-content">
                <!-- Basic Rules Page -->
                <div class="rules-page" id="rules-page-basic">
                    <h3>Basic Rules</h3>
                    <ul>
                        <li><strong>Goal:</strong> Beat the dealer by getting closer to 21 without going over.</li>
                        <li><strong>Card Values:</strong> Cards 2-10 are worth face value. Face cards (J, Q, K) are worth 10. Aces are worth 1 or 11.</li>
                        <li><strong>Blackjack:</strong> An Ace and a 10-value card dealt initially. Pays 3:2.</li>
                        <li><strong>Bust:</strong> Going over 21 means you lose immediately.</li>
                        <li><strong>Deal:</strong> You and dealer each get 2 cards. One dealer card is hidden.</li>
                        <li><strong>Hit:</strong> Take another card.</li>
                        <li><strong>Stand:</strong> Keep your current hand and let dealer play.</li>
                    </ul>
                    <div class="rules-navigation">
                        <button class="rules-next-btn" id="rules-next-btn">Advanced Rules ‚Üí</button>
                    </div>
                </div>

                <!-- Advanced Rules Page -->
                <div class="rules-page" id="rules-page-advanced" style="display: none;">
                    <h3>Advanced Rules</h3>
                    <ul>
                        <li><strong>Double Down:</strong> Double your bet and receive exactly one more card. Best after 2 cards.</li>
                        <li><strong>Split:</strong> If you have two cards of equal value, split them into two hands. Each hand gets one new card.</li>
                        <li><strong>Split Aces:</strong> When splitting Aces, you get only one card per hand and cannot hit or double down.</li>
                        <li><strong>Insurance:</strong> When dealer shows an Ace, bet up to half your bet that they have Blackjack. Pays 2:1 if correct.</li>
                        <li><strong>Soft Hand:</strong> A hand with an Ace counted as 11 (like Ace-6 = soft 17).</li>
                        <li><strong>Hard Hand:</strong> A hand where the Ace must count as 1, or no Aces (like 10-9 = hard 19).</li>
                        <li><strong>Dealer Rules:</strong> Dealer must hit on 16 or less, must stand on 17 or more.</li>
                        <li><strong>Push:</strong> If your hand ties the dealer's, it's a push and your bet is returned.</li>
                    </ul>
                    <div class="rules-navigation">
                        <button class="rules-prev-btn" id="rules-prev-btn">‚Üê Basic Rules</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Panel -->
        <div class="settings-panel" id="settings-panel" role="dialog" aria-labelledby="settings-title" aria-hidden="true">
            <div class="settings-header">
                <span class="settings-title" id="settings-title">Heckler Settings</span>
                <button class="settings-close" id="settings-close" aria-label="Close settings">‚úï</button>
            </div>
            <div class="settings-content">
                <div class="settings-row">
                    <label for="heckler-enabled-toggle" class="settings-label">Enable Voice</label>
                    <input type="checkbox" id="heckler-enabled-toggle" class="settings-checkbox">
                </div>
                <div class="settings-row">
                    <label for="heckler-voice-select" class="settings-label">Voice</label>
                    <select id="heckler-voice-select" class="settings-select" disabled>
                        <option value="" selected>Loading voices‚Ä¶</option>
                    </select>
                </div>
                <div class="settings-row">
                    <label for="heckler-speed-range" class="settings-label">Speed</label>
                    <div class="settings-range-wrapper">
                        <input type="range" id="heckler-speed-range" min="0.6" max="1.6" step="0.05" value="1.05">
                        <span class="settings-range-value" id="heckler-speed-display">1.05√ó</span>
                    </div>
                </div>
                <div class="settings-row">
                    <label for="bankroll-setting-input" class="settings-label">Starting Bankroll</label>
                    <input type="number" id="bankroll-setting-input" class="settings-input" min="1" max="1000000" step="1" value="1000">
                    <span class="settings-helper" id="bankroll-setting-helper">Used when refreshing bankroll (max $1,000,000)</span>
                </div>
                <div class="settings-row">
                    <label for="dealer-delay-input" class="settings-label">Dealer Card Delay (ms)</label>
                    <input type="number" id="dealer-delay-input" class="settings-input" min="0" max="5000" step="50" value="1000">
                    <span class="settings-helper" id="dealer-delay-helper">Delay between dealer hits (0-5000 ms)</span>
                </div>
                <div class="settings-note" id="heckler-settings-note" hidden>
                    Speech synthesis is not supported in this browser.
                </div>
            </div>
        </div>

        <div class="table-body">
            <div class="primary-column">
                <!-- Dealer Area -->
                <section class="dealer-area">
                    <div id="dealer-hand" class="card-hand"></div>
                    
                    <!-- Dealer Info Bar -->
                    <div class="dealer-display">
                        <div class="dealer-info-in-bar">
                            <span class="area-label-inline">DEALER</span>
                            <span class="hand-value-inline" id="dealer-value">Value: ?</span>
                        </div>
                        <div class="game-message" id="game-message"></div>
                    </div>
                </section>

                <!-- Player Area -->
                <section class="player-area">
                    <div id="player-hand" class="card-hand"></div>
                    
                    <!-- Current Bet Display with Player Info -->
                    <div class="bet-display">
                        <div class="player-info-in-bar">
                            <span class="area-label-inline">PLAYER</span>
                            <span class="hand-value-inline" id="player-value">Value: 0</span>
                        </div>
                        <div class="bet-info">
                            <span class="bet-label">Current Bet:</span>
                            <span class="bet-amount" id="current-bet">$0</span>
                            <button class="btn-clear-bet" id="clear-bet-btn" onclick="clearBet()">Clear Bet</button>
                        </div>
                    </div>
                </section>

                <!-- Insurance / Even Money Offer -->
                <div class="insurance-offer" id="insurance-offer">
                    <button class="btn-insurance disabled" id="insurance-btn" aria-disabled="true" title="Available when dealer shows Ace">Insurance ‚Äì pays 2:1</button>
                    <button class="btn-insurance-decline" id="insurance-decline" style="display: none;">No thanks</button>
                </div>

                <!-- Game Management -->
                <section class="game-management">
                    <button class="btn-secondary" id="new-game-btn" onclick="newGame()">New Game</button>
                    <button class="btn-secondary" id="refresh-bankroll-btn" onclick="refreshBankroll()">Refresh Bankroll</button>
                    <button class="btn-secondary" id="auto-mode-btn">Auto Mode</button>
                </section>

                <!-- Action Status Message -->
                <div class="action-status" id="action-status"></div>

                <!-- Auto Mode Panel -->
                <div class="auto-mode-panel" id="auto-mode-panel" style="display: none;">
                    <div class="auto-mode-card">
                        <div class="auto-mode-header">Auto Mode</div>
                        <div class="auto-mode-body">
                            <label class="auto-mode-label" for="auto-bet-input">Default Bet</label>
                            <input type="number" id="auto-bet-input" min="1" step="1" value="100">
                            <label class="auto-mode-label" for="auto-hands-input">Hands to Play</label>
                            <input type="number" id="auto-hands-input" min="1" step="1" value="5">
                            <div class="auto-mode-label">Insurance Preference</div>
                            <div class="auto-mode-radio-group">
                                <label><input type="radio" name="auto-insurance" value="always"> Always take</label>
                                <label><input type="radio" name="auto-insurance" value="never" checked> Never take</label>
                            </div>
                            <div class="auto-mode-actions">
                                <button class="btn-primary" id="auto-start-btn">Start</button>
                                <button class="btn-secondary" id="auto-cancel-btn">Cancel</button>
                            </div>
                            <div class="auto-mode-error" id="auto-error" aria-live="polite"></div>
                        </div>
                    </div>
                </div>

                <div class="auto-status" id="auto-status" style="display: none;">
                    <span id="auto-status-text"></span>
                    <button id="auto-download-log-btn" class="btn-download-log" style="display: none;">Download Log</button>
                </div>
            </div>

            <div class="secondary-column">
                <!-- Betting Area -->
                <section class="betting-area" id="betting-area">
                    <div class="betting-label" id="betting-label">Place Your Bet</div>
                    <div class="chip-tray" id="chip-tray">
                        <button class="chip" data-value="1" onclick="selectChip(1)">
                            <span class="chip-value">$1</span>
                        </button>
                        <button class="chip" data-value="5" onclick="selectChip(5)">
                            <span class="chip-value">$5</span>
                        </button>
                        <button class="chip" data-value="10" onclick="selectChip(10)">
                            <span class="chip-value">$10</span>
                        </button>
                        <button class="chip" data-value="25" onclick="selectChip(25)">
                            <span class="chip-value">$25</span>
                        </button>
                        <button class="chip" data-value="100" onclick="selectChip(100)">
                            <span class="chip-value">$100</span>
                        </button>
                        <button class="chip" data-value="500" onclick="selectChip(500)">
                            <span class="chip-value">$500</span>
                        </button>
                    </div>
                    <div class="betting-controls">
                        <button class="btn-primary" id="deal-btn" onclick="dealCards()">Deal Cards</button>
                    </div>
                    <section class="game-controls" id="game-controls" style="display: none;">
                        <button class="btn-action" id="hit-btn" onclick="playerHit()">Hit</button>
                        <button class="btn-action" id="stand-btn" onclick="playerStand()">Stand</button>
                        <button class="btn-action" id="double-btn" onclick="playerDoubleDown()">Double Down</button>
                        <button class="btn-action" id="split-btn" onclick="playerSplit()" style="display: none;">Split</button>
                    </section>
                    <div class="balance-display-block">
                        <span class="balance-label">Balance:</span>
                        <span class="balance-amount" id="balance">$1,000</span>
                    </div>
                </section>

                <!-- Game History Panel -->
                <section class="game-history-panel">
                    <div class="history-header">üìä Game History (Last 5)</div>
                    <div class="history-list" id="history-list">
                        <div class="history-item-empty">No games yet</div>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loading-overlay" style="display: none;">
        <div class="loading-spinner"></div>
        <div class="loading-text">Processing...</div>
    </div>

    <!-- Scripts -->
    <script src="{{ url_for('static', filename='js/card.js') }}"></script>
    <script src="{{ url_for('static', filename='js/blackjack.js') }}"></script>
</body>
</html>
